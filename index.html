<!-- 既存 index.html はそのまま -->
<script>
// ★ 既存コードは省略（変更なし） ★

async function getHistory(){
  const r = await fetch(
    `${GAS_URL}?mode=history&site=${encodeURIComponent(site)}&tool=${encodeURIComponent(tool)}&t=${Date.now()}`
  );
  const js = await r.json();
  if(js.result!=="ok") throw new Error();
  return js.items || [];
}

async function toggleHistory(){
  historyOpen = !historyOpen;
  const box = document.getElementById("hist");
  if(!historyOpen){
    box.classList.add("hidden");
    return;
  }
  box.classList.remove("hidden");
  box.innerHTML = "読み込み中…";
  try{
    const items = await getHistory();
    box.innerHTML = items.length ? items.map(x=>{
      return `<div class="histRow">
        ${new Date(x.at).toLocaleString()} / ${x.action} / ${x.user}
      </div>`;
    }).join("") : `<div class="histRow">履歴なし</div>`;
  }catch{
    box.innerHTML = `<div class="histRow">取得失敗</div>`;
  }
}
</script>
